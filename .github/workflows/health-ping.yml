name: Health Ping
on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:
jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Check /api/agi/status
        run: |
          URL="https://crsetsolutions.com/api/agi/status"
          RESP="$(curl -sS -w "\n%{http_code}" "$URL")"
          CODE="$(printf "%s" "$RESP" | tail -n1)"
          BODY="$(printf "%s" "$RESP" | sed '$d')"
          if [ "$CODE" != "200" ]; then
            echo "HTTP $CODE"; exit 1
          fi
          echo "$BODY" | grep -q '"ok":\s*true' || { echo "Body not ok: $BODY"; exit 1; }
          echo "OK"
